<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Maps Factory- Google</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <style>
      html, body, #map {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
      #buttons {
        padding: 15px
      }
    </style>
    <script src="http://code.jquery.com/jquery-1.8.2.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3.18&libraries=geometry,places,visualization&language=es"></script>
    <script src="../maps_factory.min.js" type="text/javascript"></script>
    <script type="text/javascript">
      $(document).ready(function() {
        var map = new MapsFactory({mapType: 'GoogleMaps', div: '#map', lat: -33.4205452, lng: -70.5898197, zoom: 12});
        var marker = map.addMarker(
          {
            lat: -33.4205452,
            lng: -70.5898197,
            infoWindow: '<p>HTML Content</p>',
            click: {active: true, callback: function (argument) { console.log('click'); }},
            drag: {active: true, callback: function(ev) { console.log("dragged");console.log(ev); }},
            icon: {
              image: "http://www.ipreferjim.com/site/wp-content/uploads/2012/10/markers.png?9d7bd4",
              size: [35, 36],
              sprite_position: [103, 34],
              anchor: [17, 36]
            } 
          }
        )
        map.showInfoWindows(marker);

        var circle = map.addCircle({lat: -33.44, lng: -70.599, radius: 500})
        var bounds = [[-33.4205452,-70.5898197],[-32.4205452,-70.5898197],[-34.4105452,-70.5898197],[-32.4505452,-71.5898197]];
        map.drawPolyline({
          path: bounds,
          strokeColor: '#0000000',
          strokeOpacity: 1,
          strokeWeight: 3,
          fillColor: '#BBD8E9',
          fillOpacity: 0.6
        });

        var input = document.getElementById('address');
        var options = {
          types: ['geocode']
          //componentRestrictions: {country: 'cl'}
        };

        autocomplete = new google.maps.places.Autocomplete(input, options);

        $('#geocoding_form').submit(function(e){
          e.preventDefault();
          map.geocode({
            address: $('#address').val().trim(),
            callback: function(results, status){
              if(status=='OK'){
                var latlng = results[0].geometry.location;
                map.setCenter(latlng.lat(), latlng.lng());
                map.addMarker({
                  lat: latlng.lat(),
                  lng: latlng.lng()
                });
              }
            }
          });
        });

        $("#remove_marker").click(function () {
          map.removeMarker(map.markers[map.markers.length - 1]);
        });
        $("#fit_bounds").click(function(){
          if(map.markers.length < 2){
            map.fitBounds([[-33.404492, -70.586343], [-33.419717, -70.586986]]);
          }
          else{
            map.fitBounds();
        }
        });

      });
    </script>
  </head>
  <body>
  </body>
  <div id="map" style="height: 90%" ></div>
  <div id="buttons">
    <form method="post" id="geocoding_form" style="float: right" >
      <label for="address">Address:</label>
      <div class="input">
        <input type="text" id="address" name="address" />
        <input type="submit" class="btn" value="Search" />
      </div>
    </form>
    <button id="remove_marker" style="float: left">Remove marker</button>
    <button id="fit_bounds"  >fit Bounds </button>
  </div>
</html>
